<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cadastro de Produtos - Projeto Defense</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <style>
        body {
            background-color: #f8f9fa;
        }

        .form-section {
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            padding: 2rem;
            margin-top: 2rem;
            margin-bottom: 2rem;
        }

        .section-title {
            position: relative;
            padding-left: 20px;
            margin-bottom: 25px;
            color: #2c3e50;
            font-weight: 600;
        }

        .section-title::before {
            content: "";
            position: absolute;
            left: 0;
            top: 50%;
            transform: translateY(-50%);
            height: 30px;
            width: 6px;
            background-color: #0d6efd;
            border-radius: 3px;
        }

        .section-title i {
            margin-right: 10px;
            font-size: 1.4rem;
            vertical-align: middle;
            color: #0d6efd;
        }

        .btn-custom {
            font-weight: 500;
            border-radius: 8px;
            padding: 8px 16px;
        }

        .form-label {
            font-weight: 500;
            color: #495057;
        }

        .input-group-text {
            background-color: #f1f3f5;
        }

        .preview-image {
            max-width: 150px;
            max-height: 150px;
            margin-top: 10px;
            display: none;
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="form-section">
            <h3 class="section-title"><i class="bi bi-box-seam"></i> Cadastro de Produtos</h3>
            <form id="formProduto">
                <div class="row mb-4">
                    <div class="col-md-6 mb-3 mb-md-0">
                        <label for="nomeProduto" class="form-label">Nome do Produto</label>
                        <div class="input-group">
                            <span class="input-group-text"><i class="bi bi-tag"></i></span>
                            <input type="text" class="form-control" id="nomeProduto" placeholder="Ex: Kimono Jiu-Jitsu"
                                required>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <label for="codigoProduto" class="form-label">Código do Produto</label>
                        <div class="input-group">
                            <span class="input-group-text"><i class="bi bi-upc"></i></span>
                            <input type="text" class="form-control" id="codigoProduto" placeholder="Ex: PRD-1234"
                                required>
                        </div>
                    </div>
                </div>
                <div class="row mb-4">
                    <div class="col-md-6 mb-3 mb-md-0">
                        <label for="categoria" class="form-label">Categoria</label>
                        <select class="form-select" id="categoria" required>
                            <option value="" selected disabled>Selecione a categoria</option>
                        </select>
                    </div>
                    <div class="col-md-6">
                        <label for="fornecedor" class="form-label">Fornecedor</label>
                        <select class="form-select" id="fornecedor" required>
                            <option value="" selected disabled>Selecione o fornecedor</option>
                        </select>
                    </div>
                </div>
                <div class="row mb-4">
                    <div class="col-md-4">
                        <label for="precoCusto" class="form-label">Preço de Custo</label>
                        <input type="number" step="0.01" class="form-control" id="precoCusto" required>
                    </div>
                    <div class="col-md-4">
                        <label for="precoVenda" class="form-label">Preço de Venda</label>
                        <input type="number" step="0.01" class="form-control" id="precoVenda" required>
                    </div>
                    <div class="col-md-4">
                        <label for="margemLucro" class="form-label">Margem de Lucro</label>
                        <input type="text" class="form-control" id="margemLucro" readonly>
                    </div>
                </div>
                <div class="row mb-4">
                    <div class="col-md-4">
                        <label for="quantidadeEstoque" class="form-label">Estoque</label>
                        <input type="number" class="form-control" id="quantidadeEstoque" required>
                    </div>
                    <div class="col-md-4">
                        <label for="estoqueMinimo" class="form-label">Estoque Mínimo</label>
                        <input type="number" class="form-control" id="estoqueMinimo" required>
                    </div>
                    <div class="col-md-4">
                        <label for="unidadeMedida" class="form-label">Unidade</label>
                        <select class="form-select" id="unidadeMedida" required>
                            <option value="" selected disabled>Selecione</option>
                            <option>Unidade</option>
                            <option>Par</option>
                            <option>Kg</option>
                            <option>Litro</option>
                        </select>
                    </div>
                </div>
                <div class="mb-4">
                    <label for="descricao" class="form-label">Descrição</label>
                    <textarea id="descricao" class="form-control"></textarea>
                </div>
                <div class="d-flex justify-content-between mt-4">

                    <button type="button" class="btn btn-outline-secondary btn-custom" onclick="window.location.href='https://f14ricardo.github.io/defense/'">
                        <i class="bi bi-arrow-left"></i> Voltar
                    </button>
                    <div class="d-flex gap-3">
                        <button type="reset" class="btn btn-secondary me-2">Limpar</button>
                        <button type="submit" class="btn btn-primary">Cadastrar</button>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <script>
        const fluxoListarCategorias = "https://prod-48.westus.logic.azure.com:443/workflows/df4a1df239d1456e9f0782e8b053e3b7/triggers/manual/paths/invoke?api-version=2016-06-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=97-K1LDQJj7_C19Zf-IGh2ID07OtlO5Ks-jfT7_w7_Y";
        const fluxoListarFornecedores = "https://prod-85.westus.logic.azure.com:443/workflows/9e3195fb10c048dc9354a9a134e46cfe/triggers/manual/paths/invoke?api-version=2016-06-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=4qdgEFv75lmnCW_2MneA19r_kZjaleJtVgwmAYFZyJA";
        const fluxoCadastrarProduto = "https://prod-06.westus.logic.azure.com:443/workflows/d16b11dc8398450ebb1f0b73b477a6cb/triggers/manual/paths/invoke?api-version=2016-06-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=DwCLy33gPPTBvskzCeJhPsawtDaTuxojP7xZ6vXdxSw";

        async function carregarCategorias() {
            const res = await fetch(fluxoListarCategorias, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({}) });
            const data = await res.json();
            const select = document.getElementById('categoria');
            select.innerHTML = '<option value="" disabled selected>Selecione a categoria</option>';
            data.forEach(cat => select.appendChild(new Option(cat.Categoria, cat.Categoria)));
        }

        async function carregarFornecedores() {
            const res = await fetch(fluxoListarFornecedores, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({}) });
            const data = await res.json();
            const select = document.getElementById('fornecedor');
            select.innerHTML = '<option value="" disabled selected>Selecione o fornecedor</option>';
            data.forEach(f => select.appendChild(new Option(f.Fornecedor, f.Fornecedor)));
        }

        function calcularMargem() {
            const custo = parseFloat(document.getElementById('precoCusto').value) || 0;
            const venda = parseFloat(document.getElementById('precoVenda').value) || 0;
            const margem = custo && venda ? (((venda - custo) / custo) * 100).toFixed(2) : '0';
            document.getElementById('margemLucro').value = margem;
        }

        async function cadastrarProduto(event) {
            event.preventDefault();
            const dados = {
                NomeProduto: document.getElementById("nomeProduto").value,
                CodigoProduto: document.getElementById("codigoProduto").value,
                Categoria: document.getElementById("categoria").value,
                Fornecedor: document.getElementById("fornecedor").value,
                PrecoCusto: parseFloat(document.getElementById("precoCusto").value),
                PrecoVenda: parseFloat(document.getElementById("precoVenda").value),
                MargemLucro: parseFloat(document.getElementById("margemLucro").value),
                Estoque: parseInt(document.getElementById("quantidadeEstoque").value),
                EstoqueMinimo: parseInt(document.getElementById("estoqueMinimo").value),
                Unidade: document.getElementById("unidadeMedida").value,
                Descricao: document.getElementById("descricao").value
            };
            const res = await fetch(fluxoCadastrarProduto, {
                method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(dados)
            });
            if (res.ok) {
                alert("✅ Produto cadastrado com sucesso!");
                document.getElementById("formProduto").reset();
            } else {
                alert("⚠️ Erro ao cadastrar produto.");
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            carregarCategorias();
            carregarFornecedores();
            document.getElementById("formProduto").addEventListener("submit", cadastrarProduto);
            document.getElementById("precoCusto").addEventListener("input", calcularMargem);
            document.getElementById("precoVenda").addEventListener("input", calcularMargem);
        });
    </script>
</body>

</html>